<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>闭包有啥用？闭包的应用场景 | Bin&#39;s Blog | Good Lucky.</title>

  
  <meta name="author" content="Bob Liao">
  

  
  <meta name="description" content="一个戳逼的日记本。">
  

  
  
  <meta name="keywords" content="javascript,闭包,work">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="闭包有啥用？闭包的应用场景"/>

  <meta property="og:site_name" content="Bin&#39;s Blog"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Bin&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Bin&#39;s Blog</a>
    </h1>
    <p class="site-description">Good Lucky.</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/links">Links</a></li>
      
        <li><a href="/resume">About</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>闭包有啥用？闭包的应用场景</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/07/02/should-i-use-javascript-closure.html" rel="bookmark">
        <time class="entry-date published" datetime="2017-07-02T10:33:41.000Z">
          2017-07-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>对于前端工作者来说，面试的时候被问到闭包的问题是再平常不过了。<br>但是对于我们这种刚入门的玩家来说，闭包这个东西实际应用的场景真的不多。因为闭包的好处应该会需要在真实的项目中去体会到，所以这就造成了，也许你好不容易记住或者理解了闭包。但是你很快就忘记了。这是一个非常尴尬的事情。</p>
<blockquote>
<p><strong>Don’t use closures unless you really need closure  semantics.</strong>不要使用闭包，除非你真正需要它。</p>
<p><strong>In most cases, non-nested functions are the right way to go.</strong>请使用无嵌套函数。</p>
</blockquote>
<a id="more"></a>
<h1 id="什么是闭包？"><a href="#什么是闭包？" class="headerlink" title="什么是闭包？"></a>什么是闭包？</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="keyword">var</span> i=<span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           alert(i);       </div><div class="line">&#125;       </div><div class="line"><span class="keyword">return</span> b;   </div><div class="line">&#125;   </div><div class="line"><span class="keyword">var</span> c = a();   </div><div class="line">c();</div></pre></td></tr></table></figure>
<p>全局变量c指定对 函数a的内部函数b的引用；内部函数b的执行需要依赖函数a的资源；</p>
<p>这里就产生一个闭包，使得a在执行完毕并返回后，不会被javascript垃圾回收机制GC回收。</p>
<p>因为这里c还在引用着b，而b依赖着a，故a在使用后，仍然存在于内存中。</p>
<p>简而言之：<strong>当函数a的内部函数b被函数a外的一个变量引用的时候，就创建了一个闭包。</strong></p>
<h1 id="闭包的应用场景"><a href="#闭包的应用场景" class="headerlink" title="闭包的应用场景"></a>闭包的应用场景</h1><ol>
<li>使用闭包代替全局变量</li>
<li>函数外或在其他函数中访问某一函数内部的参数</li>
<li>在函数执行之前为要执行的函数提供具体参数</li>
<li>在函数执行之前为函数提供只有在函数执行或引用时才能知道的具体参数</li>
<li>为节点循环绑定click事件，在事件函数中使用当次循环的值或节点，而不是最后一次循环的值或节点</li>
<li>暂停执行</li>
<li>包装相关功能</li>
</ol>
<h2 id="使用闭包代替全局变量"><a href="#使用闭包代替全局变量" class="headerlink" title="使用闭包代替全局变量"></a>使用闭包代替全局变量</h2><p>全局变量有变量污染和变量安全等问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//全局变量，test1是全局变量</span></div><div class="line"><span class="keyword">var</span> test1=<span class="number">111</span> </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(test1);</div><div class="line">&#125;</div><div class="line">outer(); <span class="comment">//111</span></div><div class="line">alert(test1); <span class="comment">//111</span></div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">//闭包，test2是局部变量，这是闭包的目的</span></div><div class="line"><span class="comment">//我们经常在小范围使用全局变量，这个时候就可以使用闭包来代替。</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"><span class="keyword">var</span> test2=<span class="number">222</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(test2);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="string">"测试闭包："</span>+test2);</div><div class="line">&#125;</div><div class="line">outer(); <span class="comment">//222</span></div><div class="line">test(); <span class="comment">//测试闭包：222</span></div><div class="line">&#125;</div><div class="line">)(); </div><div class="line">alert(test2); <span class="comment">//未定义，这里就访问不到test2</span></div></pre></td></tr></table></figure>
<h3 id="函数外或在其他函数中访问某一函数内部的参数"><a href="#函数外或在其他函数中访问某一函数内部的参数" class="headerlink" title="函数外或在其他函数中访问某一函数内部的参数"></a>函数外或在其他函数中访问某一函数内部的参数</h3><p>为了解决在Ajax callback回调函数中经常需要继续使用主调函数的某一些参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> test=<span class="number">111</span>;</div><div class="line">    tmp_test=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> test;&#125; <span class="comment">//tmp_test是全局变量,这里对test的引用，产生闭包</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="string">"测试一："</span>+tmp_test());</div><div class="line">    <span class="keyword">var</span> test1=tmp_test();</div><div class="line">    alert(<span class="string">"测试二："</span>+test1);</div><div class="line">&#125;</div><div class="line">f1();</div><div class="line">f2();</div><div class="line"><span class="comment">//测试一：111</span></div><div class="line"><span class="comment">//测试二：111</span></div><div class="line">alert(tmp_test()); <span class="comment">//111</span></div><div class="line">tmp_test=<span class="literal">null</span>;</div></pre></td></tr></table></figure>
<h3 id="在函数执行之前为要执行的函数提供具体参数"><a href="#在函数执行之前为要执行的函数提供具体参数" class="headerlink" title="在函数执行之前为要执行的函数提供具体参数"></a>在函数执行之前为要执行的函数提供具体参数</h3><p>某些情况下，是无法为要执行的函数提供参数，只能在函数执行之前，提前提供参数。<br>有哪些情况是延迟执行？<br>如：</p>
<ul>
<li>setTimeOut </li>
<li>setInterval</li>
<li>Ajax callbacks</li>
<li>event handler[el.onclick=func 、 el.attachEvent(“onclick”,func)]</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//无法传参的情况</span></div><div class="line"><span class="keyword">var</span> parm=<span class="number">222</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;alert(<span class="number">111</span>)&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params">obj</span>)</span>&#123;alert(obj)&#125;</div><div class="line">setTimeout(f1,<span class="number">500</span>);<span class="comment">//正确,无参数</span></div><div class="line"><span class="keyword">var</span> test1=f2(parm);<span class="comment">//执行一次f2函数</span></div><div class="line">setTimeout(f2,<span class="number">500</span>);<span class="comment">//undefined，传参失败</span></div><div class="line">setTimeout(f2(parm),<span class="number">500</span>);<span class="comment">//参数无效，传参失败</span></div><div class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params">parm</span>)</span>&#123;alert(parm)&#125;,<span class="number">500</span>);<span class="comment">//undefined，传参失败</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).onclick=f1;<span class="comment">//正确</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).attachEvent(<span class="string">"onclick"</span>,f1);<span class="comment">//正确</span></div><div class="line"> </div><div class="line"></div><div class="line"><span class="comment">//正确做法，使用闭包</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params">obj</span>)</span>&#123;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(obj)&#125;&#125;</div><div class="line"><span class="keyword">var</span> test2=f3(parm);<span class="comment">//返回f3的内部函数的引用</span></div><div class="line">setTimeout(test2,<span class="number">500</span>);<span class="comment">//正确,222</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).onclick=test2;<span class="comment">//正确,222</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).attachEvent(<span class="string">"onclick"</span>,test2);<span class="comment">//正确,222</span></div></pre></td></tr></table></figure>
<h3 id="在函数执行之前为函数提供只有在函数执行或引用时才能知道的具体参数"><a href="#在函数执行之前为函数提供只有在函数执行或引用时才能知道的具体参数" class="headerlink" title="在函数执行之前为函数提供只有在函数执行或引用时才能知道的具体参数"></a>在函数执行之前为函数提供只有在函数执行或引用时才能知道的具体参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//动态绑定a集合的注册点击事件，在事件处理函数test1中提供参数-该点击事件的a元素本身。</span></div><div class="line"><span class="keyword">var</span> aa=<span class="string">"ha!"</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">obj</span>)</span>&#123;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(obj);&#125;&#125;</div><div class="line"><span class="keyword">var</span> nodes=<span class="built_in">document</span>.getElementsByTagName(<span class="string">"a"</span>);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;nodes.length;i++)&#123;</div><div class="line">     <span class="keyword">var</span> test1=test(aa);<span class="comment">//由于是提前提供参数，只能提供已知的具体参数，无法事先得知点击事件的a元素本身。</span></div><div class="line">                <span class="comment">//这里想提供点击事件的a元素本身作为参数宣告失败！</span></div><div class="line">    nodes[i].onclick=test1;<span class="comment">//只有在注册点击事件时，才会知道该点击事件的a元素是哪个</span></div><div class="line">&#125;</div><div class="line"> </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//以下是解决方式</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">associateObjWithEvent</span>(<span class="params">obj,methodName</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">        e=e||<span class="built_in">window</span>.event;</div><div class="line">        <span class="keyword">return</span> obj[methodName](e,<span class="keyword">this</span>);<span class="comment">//重点看这里！有两个参数，</span></div><div class="line">        <span class="comment">//e:event，元素绑定事件时，绑定的是对内部函数的引用，故在触发事件时，执行的是内部函数。</span></div><div class="line">        <span class="comment">//内部函数有个e参数，刚好在事件触发时，能捕获到是什么事件类型。</span></div><div class="line">        <span class="comment">//this:这里需要的就是this参数，以便当元素触发事件处理函数执行时，this=触发事件的元素本身</span></div><div class="line">        <span class="comment">//this参数无法从外部传入进来。传入进来的this都会被转化特定对象    </span></div><div class="line">    );</div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DhtmlObject</span>(<span class="params">elId</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> el=<span class="built_in">document</span>.getElementById(elId);</div><div class="line">    <span class="keyword">if</span>(el)&#123;</div><div class="line">        <span class="comment">//el.onclick=associateObjWithEvent(this,"doOnClick");</span></div><div class="line">        el.onmouseover=associateObjWithEvent(<span class="keyword">this</span>,<span class="string">"doMouseOver"</span>);</div><div class="line">        el.onmouseout=associateObjWithEvent(<span class="keyword">this</span>,<span class="string">"doMouseOut"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">DhtmlObject.prototype.doMouseOver=<span class="function"><span class="keyword">function</span>(<span class="params">event,element</span>)</span>&#123;</div><div class="line">    alert(event);<span class="comment">//第一个参数，只在事件执行时，才知道是什么事件，这里是MouseEvent</span></div><div class="line">    alert(<span class="built_in">arguments</span>[<span class="number">0</span>]);<span class="comment">//第一参数，</span></div><div class="line">   alert(element);<span class="comment">//第二个参数，只在事件执行时，才知道是指代触发事件的元素本身</span></div><div class="line">    alert(<span class="built_in">arguments</span>[<span class="number">1</span>]);<span class="comment">//第二个参数</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> hello=<span class="keyword">new</span> DhtmlObject(<span class="string">"hello"</span>);  <span class="comment">//执行</span></div></pre></td></tr></table></figure>
<p>另一个例子<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">associateObjWithEvent</span>(<span class="params">obj,methodName</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">        e=e||<span class="built_in">window</span>.event;</div><div class="line">        <span class="keyword">return</span> obj[methodName](e);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DragListener</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.down=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="keyword">this</span>)</div><div class="line">        alert(<span class="built_in">arguments</span>[<span class="number">0</span>])</div><div class="line">    &#125;,</div><div class="line">    <span class="keyword">this</span>.move=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="number">2</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj=<span class="keyword">new</span> DragListener();</div><div class="line"></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).onmousedown =obj.down;<span class="comment">//正确 但我们在方法中用this访问到的对象是 dom</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).onmousemove = obj.move;<span class="comment">//正确</span></div><div class="line"></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).onmousedown =associateObjWithEvent(obj,<span class="string">'down'</span>);<span class="comment">//正确</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"hello"</span>).onmousemove = associateObjWithEvent(obj,<span class="string">'move'</span>);<span class="comment">//正确</span></div></pre></td></tr></table></figure></p>
<p>改进的例子，无限参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">associateObjWithEvent</span>(<span class="params">obj, methodName</span>)</span>&#123;</div><div class="line">    slice = <span class="built_in">Array</span>.prototype.slice;</div><div class="line">    <span class="keyword">var</span> args=slice.call(<span class="built_in">arguments</span>,<span class="number">2</span>);<span class="comment">//从第三个参数开始赋值</span></div><div class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;       </div><div class="line">        e = e||<span class="built_in">window</span>.event;</div><div class="line">        <span class="keyword">var</span> array = slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);</div><div class="line">        array.push(e); <span class="comment">//第一个参数为event</span></div><div class="line">        <span class="keyword">return</span> obj[methodName].apply(<span class="keyword">this</span>,array.concat(args));<span class="comment">//第二个参数，依次...</span></div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DhtmlObject</span>(<span class="params">elementId</span>)</span>&#123;   </div><div class="line">    <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementById(elementId); </div><div class="line">    <span class="keyword">if</span>(el)&#123;</div><div class="line">        <span class="comment">//el.onclick = associateObjWithEvent(this, "doOnClick");</span></div><div class="line">        el.onmouseover = associateObjWithEvent(<span class="keyword">this</span>, <span class="string">"doMouseOver"</span>,<span class="string">"hello2"</span>,<span class="string">"aaa"</span>,event);<span class="comment">//第一个参数为event，hello2是第二个参数，</span></div><div class="line">        <span class="comment">//因为event只有在事件处理函数执行时才会知道是具体什么事件类型，无法通过传参提供，传参的event只能识别为null</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">DhtmlObject.prototype.doMouseOver = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">    <span class="comment">// doMouseOver 方法体。</span></div><div class="line">    alert(<span class="string">"this:"</span>+<span class="keyword">this</span>.id);<span class="comment">//this:hello</span></div><div class="line">    alert(<span class="string">"arg0:"</span>+<span class="built_in">arguments</span>[<span class="number">0</span>]) ;<span class="comment">//arg0:MouseEvent</span></div><div class="line">    alert(<span class="string">"arg1:"</span>+<span class="built_in">arguments</span>[<span class="number">1</span>]);<span class="comment">//arg1:hello2</span></div><div class="line">    alert(<span class="string">"arg2:"</span>+<span class="built_in">arguments</span>[<span class="number">2</span>]);<span class="comment">//arg2:aaa</span></div><div class="line">    alert(<span class="string">"arg3-event:"</span>+<span class="built_in">arguments</span>[<span class="number">3</span>]);<span class="comment">//arg3-event:null</span></div><div class="line">    alert(<span class="string">"event:"</span>+event);<span class="comment">//event:MouseEvent</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//DhtmlObject("hello"); 这样写，反而出错。因为是类的写法，必须实例化才会执行。</span></div><div class="line"><span class="keyword">var</span> hello=<span class="keyword">new</span> DhtmlObject(<span class="string">"hello"</span>)</div></pre></td></tr></table></figure></p>
<h3 id="为节点循环绑定click事件，在事件函数中使用当次循环的值或节点，而不是最后一次循环的值或节点"><a href="#为节点循环绑定click事件，在事件函数中使用当次循环的值或节点，而不是最后一次循环的值或节点" class="headerlink" title="为节点循环绑定click事件，在事件函数中使用当次循环的值或节点，而不是最后一次循环的值或节点"></a>为节点循环绑定click事件，在事件函数中使用当次循环的值或节点，而不是最后一次循环的值或节点</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//假设有两个a链接，id分别为"hello"、"world"</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">obj</span>)</span>&#123; </div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(obj.id);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> nodes=<span class="built_in">document</span>.getElementsByTagName(<span class="string">"a"</span>);</div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;nodes.length;i++)&#123;</div><div class="line">    <span class="keyword">var</span> node=nodes[i]</div><div class="line">    nodes[i].attachEvent(<span class="string">"onclick"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(node.id)&#125;)<span class="comment">//点击链接时，hello链接弹出world，world链接也弹出world；</span></div><div class="line">                                                                  <span class="comment">//这是因为循环完毕后，node被赋值为world元素</span></div><div class="line">                                                                  <span class="comment">//这不是我们预期的结果！！！</span></div><div class="line">        </div><div class="line">    <span class="comment">//正确写法一   </span></div><div class="line">   <span class="comment">// 内部参数parm为任意指定的参数,如：(function(node)&#123;return function()&#123;alert(node.id)&#125;&#125;)(node)                                                         </span></div><div class="line">    nodes[i].attachEvent(<span class="string">"onclick"</span>,(<span class="function"><span class="keyword">function</span>(<span class="params">parm</span>)</span>&#123;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(parm.id)&#125;&#125;)(node))</div><div class="line">    <span class="comment">//第一次循环创建了一个闭包，缓存的node参数为hello链接。</span></div><div class="line">    <span class="comment">//第二次循环又创建了一个闭包，缓存的node参数为world链接。</span></div><div class="line">    <span class="comment">//点击链接时，hello链接弹出hello，world链接弹出world，因为他们调用的是各自的node参数</span></div><div class="line">    </div><div class="line">    <span class="comment">//正确写法二</span></div><div class="line">    <span class="keyword">var</span> func=test(node);</div><div class="line">    nodes[i].attachEvent(<span class="string">"onclick"</span>,func)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="暂停执行"><a href="#暂停执行" class="headerlink" title="暂停执行"></a>暂停执行</h3><p>出处参考：<a href="http://ljchow.cnblogs.com" target="_blank" rel="external">http://ljchow.cnblogs.com</a><br>这个可以做很多实用和有意思的交互。<br>这个是无忧上月MM的例子，用闭包实现程序的暂停执行功能，还蛮创意的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;input type=<span class="string">"button"</span> value=<span class="string">"继续"</span> onclick=<span class="string">'st();'</span>/&gt; </div><div class="line">&lt;script type="text/javascript"&gt;&lt;!-- </div><div class="line">var st = (function() &#123; </div><div class="line">alert(1); </div><div class="line">alert(2); </div><div class="line">return function() &#123; </div><div class="line">alert(3); </div><div class="line">alert(4); </div><div class="line">&#125; </div><div class="line">&#125;)(); </div><div class="line">// --&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<p>把这个作用延伸下，我想到了用他来实现window.confirm。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"> </span></div><div class="line"><span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123; <span class="keyword">return</span> <span class="string">"string"</span> == <span class="keyword">typeof</span> id ? <span class="built_in">document</span>.getElementById(id) : id; &#125; </div><div class="line"><span class="keyword">var</span> doConfirm = <span class="function"><span class="keyword">function</span>(<span class="params">divId</span>) </span>&#123; </div><div class="line">    $(divId).style.display = <span class="string">""</span>; </div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">closeDiv</span>(<span class="params"></span>) </span>&#123; $(divId).style.display = <span class="string">"none"</span>; &#125; </div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">isOk</span>) </span>&#123; </div><div class="line">        <span class="keyword">if</span> (isOk) &#123; alert(<span class="string">"Do deleting..."</span>); &#125; </div><div class="line">        closeDiv(); </div><div class="line">    &#125; </div><div class="line">&#125; </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"> </span></div><div class="line">body &#123; font-family: Arial; font-size: 13px; background-color: #FFFFFF; &#125; </div><div class="line">#confirmDiv &#123; width: 200px; height: 100px; border: dashed 1px black; position: absolute; </div><div class="line">left: 200px; top: 150px; &#125; </div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"btn2"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"删除"</span> <span class="attr">onclick</span>=<span class="string">"doConfirm('confirmDiv');"</span> /&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"confirmDiv"</span> <span class="attr">style</span>=<span class="string">"display: none;"</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">'position: absolute; left: 50px; top: 15px;'</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> </div><div class="line">你确定要删除吗?<span class="tag">&lt;/<span class="name">p</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"确定"</span> <span class="attr">onclick</span>=<span class="string">"doConfirm('confirmDiv')(true);"</span> /&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"取消"</span> <span class="attr">onclick</span>=<span class="string">"doConfirm('confirmDiv')(false);"</span> /&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="包装相关功能"><a href="#包装相关功能" class="headerlink" title="包装相关功能"></a>包装相关功能</h3><p>下面的代码定义了一个函数，这个函数用于返回一个 HTML 字符串，其中大部分内容都是常量，但这些常量字符序列中需要穿插一些可变的信息，而可变的信息由调用函数时传递的参数提供。</p>
<p>通过执行单行函数表达式返回一个内部函数，并将返回的函数赋给一个全局变量，因此这个函数也可以称为全局函数。而缓冲数组被定义为外部函数表达式的一个局部变量。它不会暴露在全局命名空间中，而且无论什么时候调用依赖它的函数都不需要重新创建这个数组。</p>
<p>如果一个函数依赖于另一（或多）个其他函数，而这些其他函数又没有必要被其他代码直接调用，那么可以运用相同的技术来包装这些函数，而通过一个公开暴露的函数来调用它们。这样，就将一个复杂的多函数处理过程封装成了一个具有移植性的代码单元。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 声明一个全局变量 - getImgInPositionedDivHtml - </span></div><div class="line">并将一次调用一个外部函数表达式返回的内部函数赋给它。</div><div class="line"></div><div class="line">   这个内部函数会返回一个用于表示绝对定位的 DIV 元素</div><div class="line">   包围着一个 IMG 元素 的 HTML 字符串，这样一来，</div><div class="line">   所有可变的属性值都由调用该函数时的参数提供：</div><div class="line">*/</div><div class="line"><span class="keyword">var</span> getImgInPositionedDivHtml = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">/* 外部函数表达式的局部变量 - buffAr - 保存着缓冲数组。</span></div><div class="line">    这个数组只会被创建一次，生成的数组实例对内部函数而言永远是可用的</div><div class="line">    因此，可供每次调用这个内部函数时使用。</div><div class="line"></div><div class="line">    其中的空字符串用作数据占位符，相应的数据</div><div class="line">    将由内部函数插入到这个数组中：</div><div class="line">    */</div><div class="line">    <span class="keyword">var</span> buffAr = [</div><div class="line">        <span class="string">'&lt;div id="'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 1, DIV ID 属性</span></div><div class="line">        <span class="string">'" style="position:absolute;top:'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 3, DIV 顶部位置</span></div><div class="line">        <span class="string">'px;left:'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 5, DIV 左端位置</span></div><div class="line">        <span class="string">'px;width:'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 7, DIV 宽度</span></div><div class="line">        <span class="string">'px;height:'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 9, DIV 高度</span></div><div class="line">        <span class="string">'px;overflow:hidden;\"&gt;&lt;img src=\"'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 11, IMG URL</span></div><div class="line">        <span class="string">'\" width=\"'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 13, IMG 宽度</span></div><div class="line">        <span class="string">'\" height=\"'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 15, IMG 调蓄</span></div><div class="line">        <span class="string">'\" alt=\"'</span>,</div><div class="line">        <span class="string">''</span>,   <span class="comment">//index 17, IMG alt 文本内容</span></div><div class="line">        <span class="string">'\"&gt;&lt;\/div&gt;'</span></div><div class="line">    ];</div><div class="line">    <span class="comment">/* 返回作为对函数表达式求值后结果的内部函数对象。</span></div><div class="line">    这个内部函数就是每次调用执行的函数</div><div class="line">    - getImgInPositionedDivHtml( ... ) -</div><div class="line">    */</div><div class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">url, id, width, height, top, left, altText</span>)</span>&#123;</div><div class="line">        <span class="comment">/* 将不同的参数插入到缓冲数组相应的位置：</span></div><div class="line">        */</div><div class="line">        buffAr[<span class="number">1</span>] = id;</div><div class="line">        buffAr[<span class="number">3</span>] = top;</div><div class="line">        buffAr[<span class="number">5</span>] = left;</div><div class="line">        buffAr[<span class="number">13</span>] = (buffAr[<span class="number">7</span>] = width);</div><div class="line">        buffAr[<span class="number">15</span>] = (buffAr[<span class="number">9</span>] = height);</div><div class="line">        buffAr[<span class="number">11</span>] = url;</div><div class="line">        buffAr[<span class="number">17</span>] = altText;</div><div class="line">        <span class="comment">/* 返回通过使用空字符串（相当于将数组元素连接起来）</span></div><div class="line">        连接数组每个元素后形成的字符串：</div><div class="line">        */</div><div class="line">        <span class="keyword">return</span> buffAr.join(<span class="string">''</span>);</div><div class="line">    &#125;); <span class="comment">//:内部函数表达式结束。</span></div><div class="line">&#125;)();</div><div class="line"><span class="comment">/*^^- :单行外部函数表达式。*/</span></div><div class="line"><span class="comment">//输出HTML字符串</span></div><div class="line"><span class="built_in">document</span>.write(getImgInPositionedDivHtml(<span class="string">"www.baidu.com"</span>,<span class="string">"hello"</span>,<span class="number">200</span>,<span class="number">100</span>,<span class="number">100</span>,<span class="number">40</span>,<span class="string">"hello"</span>))</div></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/javascript/">javascript</a><a href="/tags/闭包/">闭包</a><a href="/tags/work/">work</a>
    </span>
    

    </div>

    
  </div>
</article>

  
	<section id="comments" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'bobslogs';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>





    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2017 Bob Liao
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>